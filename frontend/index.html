<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
        <link rel = "stylesheet" type="text/css" href="../css/main_style.css">
    </head>
    <body>
        <div class="header">
            <div class="header-nav">
                <div class="header-nav-left">
                    <h3>中国地质大学申报系统</h3>
                </div>
                <div class="header-nav-right">
                    <ul id="loginbf">
                        <li><a href=""  onclick="window.location.reload()">首页</a></li>
                        <li><a href="./login.html">登录</a></li>
                        <li><a href="./register.html">注册</a></li>
                    </ul>
                    <ul id="loginaf">
                        <li><a href=""  onclick="window.location.reload()">首页</a></li>
                        <li><a id="welcome" href="./infocenter.html"></a></li>
                        <li id="logout"><a href="">退出</a></li>
                    </ul>
                    
                </div>
            </div>
        </div>
        <div class="business">
            <div class="business-list">
            <table class="table" id="table-business">
                <!-- <thead>
                    <tr>
                        <th>
                            业务编号
                        </th>
                        
                        <th>
                            业务名称
                        </th>
                        <th>
                            开始日期
                        </th>
                        <th>
                            截止日期
                        </th>
                        <th>
                            操作
                        </th>
                    </tr>
                </thead> -->
                <tbody id="businesslist">
                </tbody>
            </table>
            </div>
        </div>

        <script>
            function showUser(id){
                $("#welcome").html(id);
            }

            function showLine(info){
                var tr = $("<tr></tr>");
                tr.html("<td>" + info.bussinessid + "</td>"+"<td>" + info.bussinessname+"</td>"+"<td>"+info.starttime+"</td>"+"<td>"+info.endtime+"</td>"+"<td><input type='button' value='申请' id ='applybtn'></input></td>"); //+"<td>"+btn+a+"</a>"+"</input>"+"</td>"
                $("tbody").append(tr);
                
            }

            $(document).on("click",'#applybtn',function() {
                if(islogin!==''){
                    var id = $(this).parents("tr").children("td").eq(0).text();
                    location.href = "../backend/businessViewDetail.php?no="+id;
                }else{
                    location.href = "./login.html";
                }
            })

            function renderLine(){
                var table = document.getElementById("table-business");
                var len = table.rows.length;
                for (i = 0; i < len; i++) {
                    if (i % 2 == 0) {
                        table.rows[i].style.backgroundColor = 'rgb(152, 197, 125)';
                    } else {
                        table.rows[i].style.backgroundColor = 'rgb(142, 203, 207)';
                    }
                }
            }

            $.ajax({
                url:'../backend/index.php',
                type:'post',
                dataType:'json',
                data:{
                    starttime:'*',
                    endtime:'*',
                },
                success:function(result){
                    if(result.status == false){
                        alert('莫得项目');
                    }
                    else
                    {
                        info = result.data;
                        for(i =0;i<info.length;i++){
                            if(info[i] != null){
                                showLine(info[i]);
                    
                            }
                        }
                        renderLine();
                    }
                },
                error:function(){
                    alert('出错了~~');
                }
            })

            function getCookie(id) {
                var strCookie = document.cookie;
                var arrCookie = strCookie.split("; ");
                for (var i = 0; i < arrCookie.length; i++) {
                    var arr = arrCookie[i].split("=");
                    if (arr[0] == id)
                        return arr[1];
                }
                return "";
            }

            function exitLogin() {
                document.cookie = "id=";
                document.cookie = "password=";
                window.location.reload(true);
            }

            $('#logout').click(function(){
                exitLogin();
            })

            var islogin = getCookie("id");
            if(islogin!==''){
                $id = islogin;
                showUser($id);
                $("#loginbf").hide();
                $("#loginaf").show();
            }else{
                $("#loginbf").show();
                $("#loginaf").hide();
            }
        </script>
    </body>
</html>


